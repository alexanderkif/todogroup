(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{"424a":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",[s("div",{staticClass:"q-pa-md"},[t.getGroup&&t.getGroup.owner&&t.getGroup.owner._id===t.getUser._id?s("div",{staticClass:"row full-width justify-end q-mb-sm"},[s("q-btn",{attrs:{label:"Удалить группу","icon-right":"delete_forever",outline:"",rounded:"",color:"negative"},on:{click:function(e){e.stopPropagation(),t.openDeleteGroupDialog=!0}}})],1):t._e(),s("GroupDetailHeader"),t.getItems&&t.getItems.length?s("q-list",{staticClass:"q-mb-xl",attrs:{bordered:""}},t._l(t.getItems,(function(e){return s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:e._id,attrs:{clickable:""},on:{click:function(s){return t.openItemDetail(e)}}},[s("q-item-section",{staticClass:"q-gutter-sm",attrs:{top:"",avatar:""}},[s("q-checkbox",{attrs:{value:!!e.checked},on:{input:function(s){return t.toggleCheckedItem(e)}}})],1),s("q-item-section",{attrs:{top:"",avatar:""}},[s("q-avatar",{attrs:{rounded:"",color:"primary","text-color":"white"}},[t._v(t._s(e.itemName.charAt(0).toUpperCase()))])],1),s("q-item-section",[s("q-item-label",{staticClass:"text-h6 q-mr-sm"},[t._v(t._s(e.itemName+" - "+e.quantity))]),s("div",{staticClass:"text-caption"},[t._v(t._s(e.description))])],1),t.getGroup&&t.getGroup.owner&&t.getGroup.owner._id===t.getUser._id?s("q-item-section",{staticClass:"q-gutter-sm",attrs:{top:"",avatar:""}},[s("q-btn",{attrs:{flat:"",round:"",color:"negative",icon:"delete_forever"},on:{click:function(s){return s.stopPropagation(),t.openItemToDeleteDialog(e._id)}}})],1):t._e()],1)})),1):s("div",[s("div",{staticClass:"row justify-center text-h6"},[t._v("\n        "+t._s(t.$t("GroupDetail.noItems"))+"\n      ")])]),s("q-page-sticky",{attrs:{position:"bottom",offset:[18,18]}},[s("q-btn",{staticClass:"q-mr-sm",attrs:{rounded:"",size:"md",icon:"add",label:t.$t("GroupDetail.add"),color:"positive"},on:{click:function(e){t.addItem=!0}}}),s("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10],"content-class":"bg-positive"}},[t._v("\n        Add new item\n      ")])],1)],1),s("q-dialog",{attrs:{persistent:""},model:{value:t.addItem,callback:function(e){t.addItem=e},expression:"addItem"}},[s("q-card",{staticStyle:{"min-width":"350px"}},[s("q-card-section",{staticClass:"row bg-positive items-center q-pa-md text-white"},[s("div",{staticClass:"text-h6"},[t._v(t._s(t.$t("GroupDetail.addTitle")))]),s("q-space"),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),s("q-form",{staticClass:"q-pa-md q-gutter-sm",on:{submit:t.createItem,reset:t.onReset}},[s("q-input",{ref:"itemName",attrs:{label:t.$t("GroupDetail.itemName")+" *",hint:t.$t("GroupDetail.required"),"lazy-rules":"",rules:[function(t){return t&&t.length>0||"Please type item"}]},model:{value:t.itemName,callback:function(e){t.itemName=e},expression:"itemName"}}),s("q-input",{ref:"quantity",attrs:{label:t.$t("GroupDetail.quantity")+" *",hint:t.$t("GroupDetail.required"),"lazy-rules":"",rules:[function(t){return t&&t.length>0||"Please type quantity"}]},model:{value:t.quantity,callback:function(e){t.quantity=e},expression:"quantity"}}),s("q-input",{ref:"description",attrs:{label:t.$t("GroupDetail.decsr"),type:"textarea",rules:[function(t){return t.length<200||"Max length 200"}]},model:{value:t.description,callback:function(e){t.description=e},expression:"description"}}),s("div",{staticClass:"flex flex-center"},[s("q-btn",{attrs:{rounded:"",label:t.$t("GroupDetail.save"),type:"submit",color:"positive"}}),s("q-btn",{staticClass:"q-ml-sm",attrs:{flat:"",rounded:"",label:t.$t("GroupDetail.reset"),type:"reset",color:"positive"}})],1)],1)],1)],1),s("q-dialog",{model:{value:t.itemDetail,callback:function(e){t.itemDetail=e},expression:"itemDetail"}},[s("q-card",[s("q-card-section",{staticClass:"bg-accent text-white"},[s("div",{staticClass:"text-h6"},[t._v(t._s(t.item.itemName))])]),s("q-card-section",[s("div",[s("span",{staticClass:"text-accent text-bold"},[t._v("Текущее дело:")]),t._v(t._s(" "+t.item.quantity)+"\n        ")])]),s("q-card-section",{staticClass:"q-pt-none"},[s("div",[s("span",{staticClass:"text-accent text-bold"},[t._v("Заказчик:")]),t._v("\n          "+t._s(" "+(t.getGroupUsers.filter((function(e){return e._id===t.item.creator}))[0]?t.getGroupUsers.filter((function(e){return e._id===t.item.creator}))[0].name:"")+" - "+t.item.created)+"\n        ")])]),s("q-card-section",{staticClass:"q-pt-none"},[s("div",[s("span",{staticClass:"text-accent text-bold"},[t._v("Выполнен:")]),t._v(t._s(" "+(t.item.checked?"да":"нет"))+"\n        ")])]),s("q-card-section",{staticClass:"q-pt-none"},[s("div",{staticClass:"text-accent text-bold"},[t._v("\n          Описание:\n        ")]),s("div",{staticClass:"q-pt-none"},[t._v("\n          "+t._s(""+(t.item.description?t.item.description:"Описание отсутствует."))+"\n        ")])]),s("q-card-section",{staticClass:"q-pt-none"},[s("div",{staticClass:"text-accent text-bold"},[t._v("\n          История заказов:\n        ")]),s("div",{staticClass:"row justify-around"},[s("div",{staticClass:"text-primary text-caption"},[t._v("\n            Заказал\n          ")]),s("div",{staticClass:"text-accent text-bold q-px-md"},[t._v("\n            Количество\n          ")]),s("div",{staticClass:"text-accent"},[t._v("\n            Выполнил\n          ")])]),t._l(t.item.history,(function(e){return s("div",{key:e.index,staticClass:"row justify-between"},[s("div",{staticClass:"text-primary text-caption"},[t._v("\n            "+t._s("( "+t.getGroupUsers.filter((function(t){return t._id===e.creator}))[0].name+" - "+e.created+" )")+"\n          ")]),s("div",{staticClass:"text-accent text-bold q-mx-lg"},[t._v("\n            "+t._s(e.quantity)+"\n          ")]),s("div",{staticClass:"text-accent"},[t._v("\n            "+t._s(t.getGroupUsers.filter((function(t){return t._id===e.buyer}))[0].name+" - "+e.date)+"\n          ")])])}))],2),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"text-bold",attrs:{rounded:"",label:"OK",color:"accent"}})],1)],1)],1),s("q-dialog",{attrs:{persistent:""},model:{value:t.again,callback:function(e){t.again=e},expression:"again"}},[s("q-card",[s("q-card-section",{staticClass:"row text-white bg-primary items-center"},[s("span",{staticClass:"text-h6"},[t._v("Введите нужное количество:")])]),s("q-card-section",{staticClass:"row justify-center"},[s("q-input",{attrs:{label:t.$t("GroupDetail.quantity")},model:{value:t.newQuantity,callback:function(e){t.newQuantity=e},expression:"newQuantity"}})],1),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",rounded:"",label:"Отмена",color:"primary"}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{rounded:"",label:"Заказать снова",color:"primary"},on:{click:t.orderAgain}})],1)],1)],1),s("q-dialog",{attrs:{persistent:""},model:{value:t.buyed,callback:function(e){t.buyed=e},expression:"buyed"}},[s("q-card",[s("q-card-section",{staticClass:"bg-primary row items-center"},[s("span",{staticClass:"text-h6 text-white"},[t._v("Подтвердите выполнение")])]),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",rounded:"",label:"Отмена",color:"primary"}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{rounded:"",label:"Выполнено",color:"primary"},on:{click:t.checkItem}})],1)],1)],1),s("q-dialog",{attrs:{persistent:""},model:{value:t.itemToDeleteDialog,callback:function(e){t.itemToDeleteDialog=e},expression:"itemToDeleteDialog"}},[s("q-card",[s("q-card-section",{staticClass:"bg-negative row items-center"},[s("span",{staticClass:"text-h6 text-white"},[t._v("Позиция будет удалена")])]),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",rounded:"",label:"Отмена",color:"negative"}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{rounded:"",label:"Удалить",color:"negative"},on:{click:function(e){return t.deleteItems([t.itemToDelete])}}})],1)],1)],1),s("q-dialog",{attrs:{persistent:""},model:{value:t.openDeleteGroupDialog,callback:function(e){t.openDeleteGroupDialog=e},expression:"openDeleteGroupDialog"}},[s("q-card",[s("q-card-section",{staticClass:"bg-negative row items-center"},[s("span",{staticClass:"text-h6 text-white"},[t._v("Группа со всеми позициями будет удалена")])]),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",rounded:"",label:"Отмена",color:"negative"}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{rounded:"",label:"Удалить",color:"negative"},on:{click:t.deleteGroup}})],1)],1)],1)],1)},a=[],r=(s("e01a"),s("fb6a"),s("4e82"),s("ddb0"),s("c973")),o=s.n(r),n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"bg-primary rounded-borders q-pa-sm"},[s("div",{staticClass:"flex row text-caption text-white justify-between"},[s("div",{staticClass:"text-caption q-px-sm bg-accent rounded-borders",on:{click:t.copyID}},[s("div",{staticClass:"row"},[s("svg",{staticClass:"q-icon notranslate text-h6 q-mr-sm",attrs:{"aria-hidden":"true",role:"img",focusable:"false",viewBox:"0 0 24 24"}},[s("path",{attrs:{d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"}})]),t._v("\n          Group ID\n        ")]),s("input",{staticClass:"groupid row",staticStyle:{"background-color":"inherit",color:"inherit",border:"none",outline:"none",width:"165px"},attrs:{readonly:""},domProps:{value:t.getGroup._id}}),s("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10],"content-class":"bg-accent"}},[t._v("\n          Click to copy.\n        ")])],1),s("div",{staticClass:"text-white text-caption q-px-sm bg-accent rounded-borders"},[s("div",{staticClass:"row justify-end"},[t._v("\n          "+t._s(t.getGroup.owner?t.getGroup.owner.name+": "+t.getGroup.owner.phone:"")+"\n        ")]),s("div",{staticClass:"row justify-end"},[t._v("\n          "+t._s(t.getGroup.created)+"\n        ")])])]),s("div",{staticClass:"row justify-center text-h4 text-white text-center"},[t._v("\n      "+t._s(t.getGroup.groupName)+"\n    ")]),s("div",{staticClass:"row justify-center"},[s("div",{staticClass:"col-12 text-h6 text-white text-center"},[t._v("\n        "+t._s(t.getGroup.description)+"\n      ")])])]),s("div",{staticClass:"row q-mb-md"},t._l(t.getGroupUsers,(function(e){return s("q-chip",{key:e.index},[s("q-avatar",{attrs:{color:"accent","text-color":"white"}},[t._v(t._s(e.name.charAt(0).toUpperCase()))]),t._v("\n      "+t._s(e.name)+"\n      "),s("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10],"content-class":"bg-accent"}},[t._v("\n        "+t._s(e.phone)+"\n      ")])],1)})),1)])},c=[],l=s("2a19"),d={name:"GroupDetailHeader",methods:{copyID(){document.querySelector(".groupid").select(),document.execCommand("copy"),l["a"].create({type:"positive",position:"top",message:"Copied ID: "+document.querySelector(".groupid").value})}},created(){this.unsubscribe=this.$store.subscribe((t,e)=>{"group/setGroup"===t.type&&this.$store.dispatch("user/getUsersByIds",this.getGroup.users)})},beforeDestroy(){this.unsubscribe()},computed:{getGroup(){return this.$store.getters["group/getGroup"]},getGroupUsers(){return this.$store.getters["user/getGroupUsers"]}}},p=d,u=s("2877"),m=s("0016"),h=s("05c0"),g=s("b047"),v=s("cb32"),b=s("eebe"),q=s.n(b),y=Object(u["a"])(p,n,c,!1,null,null,null),f=y.exports;q()(y,"components",{QIcon:m["a"],QTooltip:h["a"],QChip:g["a"],QAvatar:v["a"]});var _={name:"GroupDetail",components:{GroupDetailHeader:f},data(){return{val:[],addItem:!1,item:{},itemName:"",quantity:"",description:"",itemDetail:!1,again:!1,newQuantity:"",buyed:!1,itemToDelete:"",itemToDeleteDialog:!1,openDeleteGroupDialog:!1}},created(){this.fetchGroup(),this.unsubscribe=this.$store.subscribe((t,e)=>{"group/setGroup"===t.type&&(this.$store.dispatch("user/getUsersByIds",e.group.group.users),this.$store.dispatch("item/getItemsByIds",e.group.group.items))}),this.timer=setInterval(this.fetchGroup,1e4)},beforeDestroy(){this.unsubscribe(),clearInterval(this.timer)},methods:{fetchGroup(){let t;this.$q.cookies.has("groupid")&&null!==this.$q.cookies.get("groupid")&&"undefined"!==this.$q.cookies.get("groupid")?(t=this.$q.cookies.get("groupid"),this.$store.dispatch("group/getGroup",t)):this.$router.push("/")},openItemDetail(t){this.itemDetail=!0,this.item=t},openItemToDeleteDialog(t){this.itemToDelete=t,this.itemToDeleteDialog=!0},deleteItems(t){this.removeItems(t).then(this.saveGroup),this.itemToDelete="",this.itemToDeleteDialog=!1},removeItems(t){var e=this;return o()((function*(){t&&t.length&&(yield e.$store.dispatch("item/deleteItemsByIds",t).then(e.$store.dispatch("group/removeItemsFromGroup",t)))}))()},deleteGroup(){this.removeItems(this.getGroup.items),this.$store.dispatch("group/deleteGroupById",this.getGroup._id).then(this.$router.push("/"))},toggleCheckedItem(t){this.item=t,t.checked?(this.newQuantity=t.quantity,this.again=!0):this.buyed=!0},orderAgain(){const t=Object.assign({},this.item),e=Object.assign({},this.item);e.quantity=this.newQuantity,e.checked=!1,e.creator=this.getUser._id,e.created=(new Date).toISOString().split("T")[0],e.history=this.item.history.slice(),console.log("orderAgain item = ",{old:t,new:e}),this.$store.dispatch("item/toggleItem",{old:t,new:e}).then(()=>{this.$store.dispatch("item/getItemsByIds",this.getGroup.items)})},saveGroup(){this.$store.dispatch("group/updateGroupItems",this.getGroup)},createItem(){this.addItem=!1;const t={itemName:this.itemName,quantity:this.quantity,description:this.description,checked:!1,creator:this.getUser._id,created:(new Date).toISOString().split("T")[0],history:[]};console.log(t),this.$store.dispatch("item/createItem",{old:"noold",new:t}).then(t=>{this.$store.dispatch("group/addItemIdToGroup",t).then(this.saveGroup).then(()=>{this.itemName="",this.quantity="",this.description=""})})},onReset(){this.itemName="",this.quantity="",this.description="",this.$refs.itemName.resetValidation(),this.$refs.quantity.resetValidation(),this.$refs.description.resetValidation()},checkItem(){const t=Object.assign({},this.item),e=Object.assign({},this.item);e.checked=!0;const s={quantity:e.quantity,created:e.created,creator:e.creator,date:(new Date).toISOString().split("T")[0],buyer:this.getUser._id};console.log("this.item.history = ",this.item.history),this.item.history||(this.item.history=[]),e.history=[...this.item.history],e.history.length>4&&(e.history=e.history.sort((t,e)=>new Date(e.date)-new Date(t.date)).slice(0,4).sort((t,e)=>new Date(t.date)-new Date(e.date))),e.history.push(s),console.log("pushed history = ",e.history),this.$store.dispatch("item/toggleItem",{old:t,new:e}).then(()=>{this.$store.dispatch("item/getItemsByIds",this.getGroup.items),this.buyed=!1})}},computed:{getGroup(){return this.$store.getters["group/getGroup"]},getUser(){return this.$store.getters["user/getUser"]},getGroupUsers(){return this.$store.getters["user/getGroupUsers"]},getItems(){return this.$store.getters["item/getItems"]},getUsers(){return this.$store.getters["user/getUsers"]}}},x=_,w=s("9989"),C=s("9c40"),G=s("1c1c"),D=s("66e5"),I=s("4074"),k=s("8f8e"),$=s("0170"),Q=s("de5e"),N=s("24e8"),U=s("f09f"),T=s("a370"),j=s("2c91"),A=s("0378"),S=s("27f9"),H=s("4b7e"),O=s("714f"),B=s("7f67"),V=Object(u["a"])(x,i,a,!1,null,null,null);e["default"]=V.exports;q()(V,"components",{QPage:w["a"],QBtn:C["a"],QList:G["a"],QItem:D["a"],QItemSection:I["a"],QCheckbox:k["a"],QAvatar:v["a"],QItemLabel:$["a"],QPageSticky:Q["a"],QTooltip:h["a"],QDialog:N["a"],QCard:U["a"],QCardSection:T["a"],QSpace:j["a"],QForm:A["a"],QInput:S["a"],QCardActions:H["a"]}),q()(V,"directives",{Ripple:O["a"],ClosePopup:B["a"]})}}]);